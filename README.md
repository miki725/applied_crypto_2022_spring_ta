# Applied Cryptography TA Scripts

## Structure

```shell
➜ tree
.
├── <problem set>
│   ├── source                      # autograder stuff goes here
│   │   ├── artifacts.py            # creates artifacts for grading
│   │   ├── input.py                # either extracts input from artifacts or generates it from scratch
│   │   ├── solution.py             # reference solution
│   │   └── tests.py                # pytest unittests which power autograder
│   └── submission
│       └── ps                      # copied from ../source/ but can be created from clipboard for local testing
├── Pipfile                         | configuration files for autograder
├── ...                             | but also used to bootstrap local setup
├── conftest.py                     | for testing
└── setup.sh
```

## Requirements

### System deps

- `brew install colordiff`

### Python version

Gradescope runs on py3.6 so its easier to reproduce similar env locally.
You can use [`pyenv`](https://github.com/pyenv/pyenv):

```bash
pyenv install 3.6.15
```

### Pipenv

Pipenv manages local python deps:

```bash
python3 -m pip install pipenv
pipenv install
```

### Shell

In order to use all deps locally you **must** activate pipenv envs via:

```bash
pipenv shell
```

## Python Shell

Solutions should be importable from the shell:

```python
➜ ptpython
>>> from ps2.source.solution import xor
>>> xor(b'hello', b'world')
b'\x1f\n\x1e\x00\x0b'
```

## Makefile Utilities

### Testing Reference Solution

```bash
# runs diff between example output and output
# generated by solution given example input
make <problemset>/diff

# runs grading script
make <problemset>/grade
```

### Testing With Clipboard

Same as above but requires `PASTE=true` env var:

```bash
make PASTE=true <problemset>/diff
make PASTE=true <problemset>/grade
```

### Testing With `pdbpp`

[pdbpp](https://github.com/pdbpp/pdbpp) is very useful to debug pytest failures
locally when working on the grading script. Simply add `pdb` make target to
enable it:

```bash
make pdb <problemset>/grade
```

On any failure pytest will drop into `pdbpp` sheell.

### Prepare `grading.zip`

```bash
make <problemset>/source/grading.zip
```
